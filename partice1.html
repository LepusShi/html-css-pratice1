<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"> <!-- 设置字符编码为UTF-8 -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- 设置视口，使页面适应不同设备 -->
    <title>Document</title> <!-- 设置文档标题 -->
    <link href="https://raw.githubusercontent.com/LepusShi/html-css-pratice1/refs/heads/main/main.css" rel="stylesheet" /> <!-- 引入外部CSS文件 -->
    <link rel="icon" href="https://github.com/LepusShi/html-css-pratice1/blob/main/sample.png" type="image/png"> 
</head>
<body>
    <header>
        <section>
            <div id="form">
                <label for="title">ToDoList</label> <!-- 标签，关联输入框 -->
                <input type="text" id="title" placeholder="添加ToDo" /> <!-- 文本输入框，用于输入待办事项 -->
            </div>
        </section>
    </header>
    <section>
        <h2>正在进行 <span id="todocount">0</span></h2> <!-- 显示正在进行的待办事项数量 -->
        <ol id="todolist" class="demo-box"></ol> <!-- 有序列表，显示正在进行的待办事项 -->
        <h2>已经完成 <span id="donecount">0</span></h2> <!-- 显示已完成的待办事项数量 -->
        <ul id="donelist"></ul> <!-- 无序列表，显示已完成的待办事项 -->
    </section>
    <footer>Copyright © 2014 todolist.cn <a href="#">clear</a></footer> <!-- 页脚，包含版权信息和清除按钮 -->

<script>
var title, todolist, donelist, todocount, donecount, prev; // 声明变量，用于存储DOM元素和临时数据
var list = {
    todolist: [], // 存储正在进行的待办事项
    donelist: [], // 存储已完成的待办事项
};
init();
function init() {
    title = document.querySelector("#title"); // 获取输入框元素
    todolist = document.querySelector("#todolist"); // 获取正在进行的待办事项列表元素
    donelist = document.querySelector("#donelist"); // 获取已完成的待办事项列表元素
    todocount = document.querySelector("#todocount"); // 获取正在进行的待办事项数量元素
    donecount = document.querySelector("#donecount"); // 获取已完成的待办事项数量元素
    footer = document.querySelector("footer"); // 获取页脚元素
    footer.addEventListener("click", clickHandler); // 为页脚添加点击事件监听器
    document.addEventListener("keyup", keyHandler); // 为文档添加键盘按键事件监听器
    todolist.addEventListener("change", changeHandler); // 为正在进行的待办事项列表添加更改事件监听器
    todolist.addEventListener("click", clickHandler); // 为正在进行的待办事项列表添加点击事件监听器
    todolist.addEventListener("dblclick", dblClickHandler); // 为正在进行的待办事项列表添加双击事件监听器
    todolist.addEventListener("focusout", blurHandler); // 为正在进行的待办事项列表添加失焦事件监听器

    donelist.addEventListener("change", changeHandler); // 为已完成的待办事项列表添加更改事件监听器
    donelist.addEventListener("click", clickHandler); // 为已完成的待办事项列表添加点击事件监听器

    // 初始化渲染
    // 如果在localStorage中找到上次保存的信息直接进行初始化渲染
    if (localStorage.list) {
        list = JSON.parse(localStorage.list); // 从localStorage中读取数据并解析为JSON对象
        render(); // 调用render函数进行渲染
    }
}
function render() {
    todolist.innerHTML = ""; // 清空正在进行的待办事项列表
    donelist.innerHTML = ""; // 清空已完成的待办事项列表
    list.todolist.forEach(function (item, index) { // 遍历正在进行的待办事项列表
        var li = document.createElement("li"); // 创建一个新的li元素
        li.innerHTML = `
            <input type="checkbox" /> <!-- 复选框，用于标记是否完成 -->
            <p>${item}</p> <!-- 显示待办事项内容 -->
            <a href="#">X</a> <!-- 删除按钮 -->
        `;
        todolist.appendChild(li); // 将li元素添加到正在进行的待办事项列表中
    });
    list.donelist.forEach(function (item, index) { // 遍历已完成的待办事项列表
        var li = document.createElement("li"); // 创建一个新的li元素
        li.innerHTML = `
            <input type="checkbox" checked /> <!-- 复选框，已选中状态 -->
            <p>${item}</p> <!-- 显示待办事项内容 -->
            <a href="#">X</a> <!-- 删除按钮 -->
        `;
        donelist.appendChild(li); // 将li元素添加到已完成的待办事项列表中
    });
    todocount.innerHTML = list.todolist.length; // 更新正在进行的待办事项数量
    donecount.innerHTML = list.donelist.length; // 更新已完成的待办事项数量
}
function keyHandler(e) {
    if (e.keyCode !== 13) return; // 如果按下的不是回车键，直接返回
    if (title.value === "") return; // 如果输入框为空，直接返回
    list.todolist.push(title.value); // 将输入框内容添加到正在进行的待办事项列表中
    title.value = ""; // 清空输入框
    render(); // 调用render函数进行渲染
}
function changeHandler(e) {
    if (e.target.nodeName !== "INPUT") return; // 如果事件目标不是复选框，直接返回
    if (e.target.parentElement.nodeName === "LI") {
        switchList(e.target, e.target.checked, false); // 调用switchList函数处理复选框状态变化
    }
}
function clickHandler(e) {
    if (e.target.nodeName !== "A") return; // 如果事件目标不是删除按钮，直接返回
    if (e.target.parentElement.nodeName === "LI") {
        switchList(
            e.target,
            !e.target.parentElement.firstElementChild.checked, // 取反复选框状态
            true
        ); // 调用switchList函数处理删除操作
    } else {
        // 如果点击的A标签不是li中的A标签而是footer中的A标签
        // 则清空list中todolist和donelist然后重绘，实现一键清空
        list.todolist.length = 0; // 清空正在进行的待办事项列表
        list.donelist.length = 0; // 清空已完成的待办事项列表
        console.log(list); // 输出当前list状态
        render(); // 调用render函数进行渲染
    }
}
function dblClickHandler(e) {
    if (e.target.nodeName !== "P") return; // 如果事件目标不是待办事项内容，直接返回
    prev = e.target; // 保存当前待办事项内容元素
    var input = document.createElement("input"); // 创建一个新的输入框元素
    input.value = e.target.innerHTML; // 设置输入框的值为当前待办事项内容
    input.style.width = e.target.offsetWidth + "px"; // 设置输入框的宽度与待办事项内容相同
    input.style.height = e.target.offsetHeight + "px"; // 设置输入框的高度与待办事项内容相同
    input.style.lineHeight = e.target.offsetHeight + "px"; // 设置输入框的行高与待办事项内容相同
    input.style.textIndent = e.target.style.textIndent; // 设置输入框的文本缩进与待办事项内容相同
    input.style.fontSize = e.target.style.fontSize; // 设置输入框的字体大小与待办事项内容相同
    e.target.parentNode.insertBefore(input, e.target); // 将输入框插入到待办事项内容之前
    e.target.style.display = "none"; // 隐藏待办事项内容
    input.focus(); // 设置输入框为焦点
}
function blurHandler(e) {
    if (e.target.nodeName !== "INPUT") return; // 如果事件目标不是输入框，直接返回
    var p = document.createElement("p"); // 创建一个新的段落元素
    p.innerHTML = e.target.value; // 设置段落的值为输入框的内容
    p.style.width = e.target.offsetWidth + "px"; // 设置段落的宽度与输入框相同
    p.style.height = e.target.offsetHeight + "px"; // 设置段落的高度与输入框相同
    p.style.lineHeight = e.target.offsetHeight + "px"; // 设置段落的行高与输入框相同
    p.style.textIndent = e.target.style.textIndent; // 设置段落的文本缩进与输入框相同
    p.style.fontSize = e.target.style.fontSize; // 设置段落的字体大小与输入框相同
    e.target.parentNode.insertBefore(p, e.target); // 将段落插入到输入框之前
    e.target.style.display = "none"; // 隐藏输入框
    prev.innerHTML = e.target.value; // 更新待办事项内容
    render(); // 调用render函数进行渲染
}
function switchList(target, checked, isClick) {
    var li = target.parentElement; // 获取目标元素的父元素li
    var item = li.querySelector("p").innerHTML; // 获取待办事项内容
    if (checked) {
        list.donelist.push(item); // 如果复选框选中，将待办事项添加到已完成的待办事项列表中
    } else {
        list.todolist.push(item); // 如果复选框未选中，将待办事项添加到正在进行的待办事项列表中
    }
    li.remove(); // 移除当前li元素
    render(); // 调用render函数进行渲染
}

</script>
</body>
</html>
